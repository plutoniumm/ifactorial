import{S as He,i as je,s as Ze,y as Je,a as v,k as h,q as de,K as ce,z as Qe,c as f,l as d,m as o,r as ue,h as n,L as ve,n as r,A as We,b as Re,E as i,I as et,g as tt,d as st,B as it,o as at}from"../chunks/index.33b5794c.js";import{M as rt}from"../chunks/meta.168d2e6e.js";class lt{constructor(e,t,s){this.startTiles=2,this.size=e,this.inputManager=new t,this.actuator=new s,this.inputManager.on("move",this.move.bind(this)),this.inputManager.on("restart",this.restart.bind(this)),this.inputManager.on("undo",this.undo.bind(this)),this.inputManager.on("keepPlaying",this.keepPlaying.bind(this)),this.setup()}restart(){this.actuator.continueGame(),this.setup()}undo(){this.undoState&&(this.grid=new Ue(this.undoState.grid.size,this.undoState.grid.cells),this.over=this.undoState.over,this.won=this.undoState.won,this.keepPlaying=this.undoState.keepPlaying,this.actuate())}keepPlaying(){this.keepPlaying=!0,this.actuator.continueGame()}isGameTerminated(){return this.over||this.won&&!this.keepPlaying}setup(){this.grid=new Ue(this.size),this.over=!1,this.won=!1,this.keepPlaying=!1,this.addStartTiles(),this.actuate()}addStartTiles(){for(var e=0;e<this.startTiles;e++)this.addRandomTile()}addRandomTile(){if(this.grid.cellsAvailable()){var e=Math.random()<.9?2:4,t=new Ge(this.grid.randomAvailableCell(),e);this.grid.insertTile(t)}}actuate(){this.actuator.actuate(this.grid,{over:this.over,won:this.won,terminated:this.isGameTerminated()})}serialize(){return{grid:this.grid.serialize(),over:this.over,won:this.won,keepPlaying:this.keepPlaying}}prepareTiles(){this.grid.eachCell(function(e,t,s){s&&(s.mergedFrom=null,s.save())})}moveTile(e,t){this.grid.cells[e.x][e.y]=null,this.grid.cells[t.x][t.y]=e,e.update(t)}move(e){this.undoState=this.serialize();var t=this;if(!this.isGameTerminated()){var s,a,c=this.getVector(e),l=this.buildTraversals(c),u=!1;this.prepareTiles(),l.x.forEach(function(m){l.y.forEach(function(P){if(s={x:m,y:P},a=t.grid.cellContent(s),a){var y=t.findFarthestPosition(s,c),g=t.grid.cellContent(y.next);if(g&&g.value===a.value&&!g.mergedFrom){var E=new Ge(y.next,a.value*2);E.mergedFrom=[a,g],t.grid.insertTile(E),t.grid.removeTile(a),a.update(y.next),E.value===2048&&(t.won=!0)}else t.moveTile(a,y.farthest);t.positionsEqual(s,a)||(u=!0)}})}),u&&(this.addRandomTile(),this.movesAvailable()||(this.over=!0),this.actuate())}}getVector(e){var t={0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}};return t[e]}buildTraversals(e){for(var t={x:[],y:[]},s=0;s<this.size;s++)t.x.push(s),t.y.push(s);return e.x===1&&(t.x=t.x.reverse()),e.y===1&&(t.y=t.y.reverse()),t}findFarthestPosition(e,t){var s;do s=e,e={x:s.x+t.x,y:s.y+t.y};while(this.grid.withinBounds(e)&&this.grid.cellAvailable(e));return{farthest:s,next:e}}movesAvailable(){return this.grid.cellsAvailable()||this.tileMatchesAvailable()}tileMatchesAvailable(){for(var e=this,t,s=0;s<this.size;s++)for(var a=0;a<this.size;a++)if(t=this.grid.cellContent({x:s,y:a}),t)for(var c=0;c<4;c++){var l=e.getVector(c),u={x:s+l.x,y:a+l.y},m=e.grid.cellContent(u);if(m&&m.value===t.value)return!0}return!1}positionsEqual(e,t){return e.x===t.x&&e.y===t.y}}class Ue{constructor(e,t){this.size=e,this.cells=t?this.fromState(t):this.empty()}empty(){for(var e=[],t=0;t<this.size;t++)for(var s=e[t]=[],a=0;a<this.size;a++)s.push(null);return e}fromState(e){for(var t=[],s=0;s<this.size;s++)for(var a=t[s]=[],c=0;c<this.size;c++){var l=e[s][c];a.push(l?new Ge(l.position,l.value):null)}return t}randomAvailableCell(){var e=this.availableCells();if(e.length)return e[Math.floor(Math.random()*e.length)]}availableCells(){var e=[];return this.eachCell(function(t,s,a){a||e.push({x:t,y:s})}),e}eachCell(e){for(var t=0;t<this.size;t++)for(var s=0;s<this.size;s++)e(t,s,this.cells[t][s])}cellsAvailable(){return!!this.availableCells().length}cellAvailable(e){return!this.cellOccupied(e)}cellOccupied(e){return!!this.cellContent(e)}cellContent(e){return this.withinBounds(e)?this.cells[e.x][e.y]:null}insertTile(e){this.cells[e.x][e.y]=e}removeTile(e){this.cells[e.x][e.y]=null}withinBounds(e){return e.x>=0&&e.x<this.size&&e.y>=0&&e.y<this.size}serialize(){for(var e=[],t=0;t<this.size;t++)for(var s=e[t]=[],a=0;a<this.size;a++)s.push(this.cells[t][a]?this.cells[t][a].serialize():null);return{size:this.size,cells:e}}}class nt{constructor(){this.tileContainer=document.querySelector(".tile"),this.messageContainer=document.querySelector(".game-message")}actuate(e,t){var s=this;window.requestAnimationFrame(function(){s.clearContainer(s.tileContainer),e.cells.forEach(function(a){a.forEach(function(c){c&&s.addTile(c)})}),t.terminated&&(t.over?s.message(!1):t.won&&s.message(!0))})}continueGame(){this.clearMessage()}clearContainer(e){for(;e.firstChild;)e.removeChild(e.firstChild)}addTile(e){var t=this,s=document.createElement("div"),a=document.createElement("div"),c=e.previousPosition||{x:e.x,y:e.y},l=this.positionClass(c),u=["tile","tile-"+e.value,l];e.value>2048&&u.push("tile-super"),this.applyClasses(s,u),a.classList.add("tile-inner"),a.textContent=e.value,e.previousPosition?window.requestAnimationFrame(function(){u[2]=t.positionClass({x:e.x,y:e.y}),t.applyClasses(s,u)}):e.mergedFrom?(u.push("tile-merged"),this.applyClasses(s,u),e.mergedFrom.forEach(function(m){t.addTile(m)})):(u.push("tile-new"),this.applyClasses(s,u)),s.appendChild(a),this.tileContainer.appendChild(s)}applyClasses(e,t){e.setAttribute("class",t.join(" "))}normalizePosition(e){return{x:e.x+1,y:e.y+1}}positionClass(e){return e=this.normalizePosition(e),"tile-position-"+e.x+"-"+e.y}message(e){var t=e?"game-won":"game-over",s=e?"You win!":"Game over!";this.messageContainer.classList.add(t),this.messageContainer.getElementsByTagName("p")[0].textContent=s}clearMessage(){this.messageContainer.classList.remove("game-won"),this.messageContainer.classList.remove("game-over")}}class ot{constructor(){this.events={},this.eventTouchstart="touchstart",this.eventTouchmove="touchmove",this.eventTouchend="touchend",this.listen()}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}emit(e,t){var s=this.events[e];s&&s.forEach(function(a){a(t)})}listen(){var e=this,t={38:0,39:1,40:2,37:3,75:0,76:1,74:2,72:3,87:0,68:1,83:2,65:3};document.addEventListener("keydown",function(l){var u=l.altKey||l.ctrlKey||l.metaKey||l.shiftKey,m=t[l.which];!u&&m!==void 0&&(l.preventDefault(),e.emit("move",m)),!u&&l.which===82&&e.restart.call(e,l),!u&&l.which===85&&e.undo.call(e,l)}),this.bindButtonPress("#retry-button",this.restart),this.bindButtonPress("#restart-button",this.restart),this.bindButtonPress("#undo-button",this.undo),this.bindButtonPress("#keep-button",this.keepPlaying);var s,a,c=document.getElementsByClassName("game-container")[0];c.addEventListener(this.eventTouchstart,function(l){!window.navigator.msPointerEnabled&&l.touches.length>1||l.targetTouches.length>1||(window.navigator.msPointerEnabled?(s=l.pageX,a=l.pageY):(s=l.touches[0].clientX,a=l.touches[0].clientY),l.preventDefault())}),c.addEventListener(this.eventTouchmove,function(l){l.preventDefault()}),c.addEventListener(this.eventTouchend,function(l){if(!(!window.navigator.msPointerEnabled&&l.touches.length>0||l.targetTouches.length>0)){var u,m;window.navigator.msPointerEnabled?(u=l.pageX,m=l.pageY):(u=l.changedTouches[0].clientX,m=l.changedTouches[0].clientY);var P=u-s,y=Math.abs(P),g=m-a,E=Math.abs(g);Math.max(y,E)>10&&e.emit("move",y>E?P>0?1:3:g>0?2:0)}})}restart(e){e.preventDefault(),this.emit("restart")}undo(e){e.preventDefault(),this.emit("undo")}keepPlaying(e){e.preventDefault(),this.emit("keepPlaying")}bindButtonPress(e,t){var s=document.querySelector(e);s.addEventListener("click",t.bind(this)),s.addEventListener(this.eventTouchend,t.bind(this))}}class Ge{constructor(e,t){this.mergedFrom=null,this.previousPosition=null,this.x=e.x,this.y=e.y,this.value=t||2}save(){this.previousPosition={x:this.x,y:this.y}}update(e){this.x=e.x,this.y=e.y}serialize(){return{position:{x:this.x,y:this.y},value:this.value}}}function ht(L){let e,t,s,a,c,l,u,m,P,y,g,E,fe,F,_,Y,ge,D,V,le,me,I,G,pe,ye,$,Ee,we,w,b,X,be,N,Ce,O,Te,R,xe,C,U,_e,H,De,j,Pe,Z,Ve,T,J,Ie,Q,ze,W,ke,ee,Me,x,te,Se,se,Ae,ie,Be,ae,Le,re,ne;return e=new rt({props:{description:"Flow based on numberlink",name:"Flow Game"}}),{c(){Je(e.$$.fragment),t=v(),s=h("div"),a=h("div"),c=h("h1"),l=de("2"),u=h("sup"),m=de("17"),P=v(),y=h("button"),g=ce("svg"),E=ce("path"),fe=v(),F=h("button"),_=ce("svg"),Y=ce("path"),ge=v(),D=h("div"),V=h("div"),le=h("p"),me=v(),I=h("div"),G=h("a"),pe=de("Keep going"),ye=v(),$=h("a"),Ee=de("Try again"),we=v(),w=h("div"),b=h("div"),X=h("div"),be=v(),N=h("div"),Ce=v(),O=h("div"),Te=v(),R=h("div"),xe=v(),C=h("div"),U=h("div"),_e=v(),H=h("div"),De=v(),j=h("div"),Pe=v(),Z=h("div"),Ve=v(),T=h("div"),J=h("div"),Ie=v(),Q=h("div"),ze=v(),W=h("div"),ke=v(),ee=h("div"),Me=v(),x=h("div"),te=h("div"),Se=v(),se=h("div"),Ae=v(),ie=h("div"),Be=v(),ae=h("div"),Le=v(),re=h("div"),this.h()},l(p){Qe(e.$$.fragment,p),t=f(p),s=d(p,"DIV",{class:!0});var z=o(s);a=d(z,"DIV",{class:!0});var q=o(a);c=d(q,"H1",{class:!0});var Fe=o(c);l=ue(Fe,"2"),u=d(Fe,"SUP",{});var $e=o(u);m=ue($e,"17"),$e.forEach(n),Fe.forEach(n),P=f(q),y=d(q,"BUTTON",{id:!0});var qe=o(y);g=ve(qe,"svg",{viewBox:!0,width:!0,height:!0,fill:!0,stroke:!0});var Ke=o(g);E=ve(Ke,"path",{d:!0}),o(E).forEach(n),Ke.forEach(n),qe.forEach(n),fe=f(q),F=d(q,"BUTTON",{id:!0});var Ye=o(F);_=ve(Ye,"svg",{viewBox:!0,width:!0,height:!0,fill:!0,stroke:!0});var Xe=o(_);Y=ve(Xe,"path",{d:!0}),o(Y).forEach(n),Xe.forEach(n),Ye.forEach(n),q.forEach(n),ge=f(z),D=d(z,"DIV",{class:!0});var K=o(D);V=d(K,"DIV",{class:!0});var oe=o(V);le=d(oe,"P",{}),o(le).forEach(n),me=f(oe),I=d(oe,"DIV",{class:!0});var he=o(I);G=d(he,"A",{id:!0});var Ne=o(G);pe=ue(Ne,"Keep going"),Ne.forEach(n),ye=f(he),$=d(he,"A",{id:!0});var Oe=o($);Ee=ue(Oe,"Try again"),Oe.forEach(n),he.forEach(n),oe.forEach(n),we=f(K),w=d(K,"DIV",{class:!0});var k=o(w);b=d(k,"DIV",{class:!0});var M=o(b);X=d(M,"DIV",{class:!0}),o(X).forEach(n),be=f(M),N=d(M,"DIV",{class:!0}),o(N).forEach(n),Ce=f(M),O=d(M,"DIV",{class:!0}),o(O).forEach(n),Te=f(M),R=d(M,"DIV",{class:!0}),o(R).forEach(n),M.forEach(n),xe=f(k),C=d(k,"DIV",{class:!0});var S=o(C);U=d(S,"DIV",{class:!0}),o(U).forEach(n),_e=f(S),H=d(S,"DIV",{class:!0}),o(H).forEach(n),De=f(S),j=d(S,"DIV",{class:!0}),o(j).forEach(n),Pe=f(S),Z=d(S,"DIV",{class:!0}),o(Z).forEach(n),S.forEach(n),Ve=f(k),T=d(k,"DIV",{class:!0});var A=o(T);J=d(A,"DIV",{class:!0}),o(J).forEach(n),Ie=f(A),Q=d(A,"DIV",{class:!0}),o(Q).forEach(n),ze=f(A),W=d(A,"DIV",{class:!0}),o(W).forEach(n),ke=f(A),ee=d(A,"DIV",{class:!0}),o(ee).forEach(n),A.forEach(n),Me=f(k),x=d(k,"DIV",{class:!0});var B=o(x);te=d(B,"DIV",{class:!0}),o(te).forEach(n),Se=f(B),se=d(B,"DIV",{class:!0}),o(se).forEach(n),Ae=f(B),ie=d(B,"DIV",{class:!0}),o(ie).forEach(n),Be=f(B),ae=d(B,"DIV",{class:!0}),o(ae).forEach(n),B.forEach(n),k.forEach(n),Le=f(K),re=d(K,"DIV",{class:!0}),o(re).forEach(n),K.forEach(n),z.forEach(n),this.h()},h(){r(c,"class","title"),r(E,"d","M29 16 C29 22 24 29 16 29 8 29 3 22 3 16 3 10 8 3 16 3 21 3 25 6 27 9 M20 10 L27 9 28 2"),r(g,"viewBox","0 0 32 32"),r(g,"width","28"),r(g,"height","28"),r(g,"fill","transparent"),r(g,"stroke","#fff"),r(y,"id","undo-button"),r(Y,"d","M16 2 L2 16 16 30 16 16 30 30 30 2 16 16 Z"),r(_,"viewBox","0 0 32 32"),r(_,"width","28"),r(_,"height","28"),r(_,"fill","none"),r(_,"stroke","#fff"),r(F,"id","restart-button"),r(a,"class","heading"),r(G,"id","keep-button"),r($,"id","retry-button"),r(I,"class","lower"),r(V,"class","game-message"),r(X,"class","grid-cell"),r(N,"class","grid-cell"),r(O,"class","grid-cell"),r(R,"class","grid-cell"),r(b,"class","grid-row"),r(U,"class","grid-cell"),r(H,"class","grid-cell"),r(j,"class","grid-cell"),r(Z,"class","grid-cell"),r(C,"class","grid-row"),r(J,"class","grid-cell"),r(Q,"class","grid-cell"),r(W,"class","grid-cell"),r(ee,"class","grid-cell"),r(T,"class","grid-row"),r(te,"class","grid-cell"),r(se,"class","grid-cell"),r(ie,"class","grid-cell"),r(ae,"class","grid-cell"),r(x,"class","grid-row"),r(w,"class","grid"),r(re,"class","tile"),r(D,"class","game game-container"),r(s,"class","container")},m(p,z){We(e,p,z),Re(p,t,z),Re(p,s,z),i(s,a),i(a,c),i(c,l),i(c,u),i(u,m),i(a,P),i(a,y),i(y,g),i(g,E),i(a,fe),i(a,F),i(F,_),i(_,Y),i(s,ge),i(s,D),i(D,V),i(V,le),i(V,me),i(V,I),i(I,G),i(G,pe),i(I,ye),i(I,$),i($,Ee),i(D,we),i(D,w),i(w,b),i(b,X),i(b,be),i(b,N),i(b,Ce),i(b,O),i(b,Te),i(b,R),i(w,xe),i(w,C),i(C,U),i(C,_e),i(C,H),i(C,De),i(C,j),i(C,Pe),i(C,Z),i(w,Ve),i(w,T),i(T,J),i(T,Ie),i(T,Q),i(T,ze),i(T,W),i(T,ke),i(T,ee),i(w,Me),i(w,x),i(x,te),i(x,Se),i(x,se),i(x,Ae),i(x,ie),i(x,Be),i(x,ae),i(D,Le),i(D,re),ne=!0},p:et,i(p){ne||(tt(e.$$.fragment,p),ne=!0)},o(p){st(e.$$.fragment,p),ne=!1},d(p){it(e,p),p&&n(t),p&&n(s)}}}function dt(L){return at(()=>new lt(4,ot,nt)),[]}class vt extends He{constructor(e){super(),je(this,e,dt,ht,Ze,{})}}export{vt as component};
