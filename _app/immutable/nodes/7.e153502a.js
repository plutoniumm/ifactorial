import{S as E,i as S,s as k,k as d,q as m,a as L,l as f,m as u,r as w,h as c,c as D,n as b,p as C,b as I,E as p,I as g,o as T,w as _}from"../chunks/index.33b5794c.js";const x={colors:{surface:"var(--color-surface)",empty:"#f4f4f5",ghost:"#ddd"},shadows:{elevated:"6px 6px 12px var(--elevated-D), -6px -6px 12px var(--elevated-L)",hover:"4px 4px 10px var(--hover-D), -4px -4px 10px var(--hover-L), inset 2px 2px 6px var(--inset-D), inset -2px -2px 6px var(--inset-L)",pressed:"inset 4px 4px 12px var(--elevated-D), inset -4px -4px 12px var(--elevated-L)"},cellBase:{borderRadius:"8px",background:"transparent",boxShadow:"6px 6px 12px var(--elevated-D), -6px -6px 12px var(--elevated-L)"}};class A{constructor(t,s){this.cols=10,this.rows=20,this.board=[],this.nodes=[],this.bag=[],this.p={x:0,y:0,shape:[],type:""},this.score=0,this.over=!1,this.last=0,this.dt=0,this.step=1e3,this.raf=null,this.colors={I:"#00f0f0",O:"#f0f000",T:"#a000f0",S:"#00f000",Z:"#f00000",J:"#0000f0",L:"#f0a000"},this.root=t,this.scoreNode=s,this.binds=this.binds.bind(this),this.loop=this.loop.bind(this),this.init()}init(){this.board=Array.from({length:this.rows},()=>Array(this.cols).fill(0)),this.initGrid(),this.reset(),document.addEventListener("keydown",this.binds),this.loop()}initGrid(){this.root.innerHTML="",this.nodes=[],Object.assign(this.root.style,{display:"grid",gridTemplateColumns:`repeat(${this.cols}, 1fr)`,gap:"0.35vmin"});for(let t=0;t<this.rows*this.cols;t++){const s=document.createElement("div");this.root.appendChild(s),this.nodes.push(s)}}binds(t){if(this.over)return;const s=t.keyCode;s===37&&this.move(-1),s===39&&this.move(1),s===40&&this.drop(),s===38&&this.rotate(1),s===32&&this.hardDrop()}getPiece(t){return t==="I"?[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]:t==="L"?[[0,2,0],[0,2,0],[0,2,2]]:t==="J"?[[0,3,0],[0,3,0],[3,3,0]]:t==="O"?[[4,4],[4,4]]:t==="Z"?[[5,5,0],[0,5,5],[0,0,0]]:t==="S"?[[0,6,6],[6,6,0],[0,0,0]]:t==="T"?[[0,7,0],[7,7,7],[0,0,0]]:[]}shuffle(){const t="ILJOTSZ".split("");for(let s=t.length-1;s>0;s--){const e=Math.floor(Math.random()*(s+1));[t[s],t[e]]=[t[e],t[s]]}this.bag.push(...t)}reset(){this.bag.length===0&&this.shuffle(),this.p.type=this.bag.pop(),this.p.shape=this.getPiece(this.p.type),this.p.y=0,this.p.x=(this.cols/2|0)-(this.p.shape[0].length/2|0),this.collide(this.p.x,this.p.y,this.p.shape)&&(this.board.forEach(t=>t.fill(0)),this.score=0,this.updateScore())}collide(t,s,e){for(let i=0;i<e.length;i++)for(let o=0;o<e[i].length;o++)if(e[i][o]!==0&&(this.board[s+i]&&this.board[s+i][t+o])!==0)return!0;return!1}rotate(t){this.p.x;const s=this.p.shape.map(e=>[...e]);for(let e=0;e<s.length;++e)for(let i=0;i<e;++i)[s[i][e],s[e][i]]=[s[e][i],s[i][e]];t>0?s.forEach(e=>e.reverse()):s.reverse(),this.collide(this.p.x,this.p.y,s)||(this.p.shape=s)}move(t){this.p.x+=t,this.collide(this.p.x,this.p.y,this.p.shape)&&(this.p.x-=t)}drop(){this.p.y++,this.collide(this.p.x,this.p.y,this.p.shape)&&(this.p.y--,this.merge(),this.reset(),this.sweep()),this.dt=0}hardDrop(){for(;!this.collide(this.p.x,this.p.y+1,this.p.shape);)this.p.y++;this.drop()}merge(){this.p.shape.forEach((t,s)=>{t.forEach((e,i)=>{e!==0&&(this.board[s+this.p.y][i+this.p.x]=e)})})}sweep(){let t=0;t:for(let s=this.rows-1;s>0;--s){for(let i=0;i<this.cols;++i)if(this.board[s][i]===0)continue t;const e=this.board.splice(s,1)[0].fill(0);this.board.unshift(e),++s,t++}t>0&&(this.score+=[0,40,100,300,1200][t],this.updateScore())}updateScore(){this.scoreNode.innerText=this.score.toString(),this.step=Math.max(100,1e3-Math.floor(this.score/500)*50)}draw(){const t=new Array(this.rows*this.cols).fill(null);this.board.forEach((e,i)=>{e.forEach((o,r)=>{o!==0&&(t[i*this.cols+r]=this.getColor(o))})});let s=this.p.y;for(;!this.collide(this.p.x,s+1,this.p.shape);)s++;this.p.shape.forEach((e,i)=>{e.forEach((o,r)=>{if(o!==0){const h=(s+i)*this.cols+(this.p.x+r);t[h]||(t[h]=x.colors.ghost)}})}),this.p.shape.forEach((e,i)=>{e.forEach((o,r)=>{o!==0&&(t[(this.p.y+i)*this.cols+(this.p.x+r)]=this.colors[this.p.type])})});for(let e=0;e<this.nodes.length;e++){const i=t[e],o=this.nodes[e];i?(Object.assign(o.style,x.cellBase),o.style.boxShadow=x.cellBase.boxShadow||"",o.style.backgroundColor=i,o.style.opacity="1"):(o.style.background="transparent",o.style.backgroundColor="transparent",o.style.boxShadow="none",o.style.opacity="0",o.style.borderRadius=x.cellBase.borderRadius,o.style.transition="")}}getColor(t){const s=["I","L","J","O","Z","S","T"];return this.colors[s[t-1]]||"#999"}loop(t=0){const s=t-this.last;this.last=t,this.dt+=s,this.dt>this.step&&this.drop(),this.draw(),this.raf=requestAnimationFrame(this.loop)}kill(){document.removeEventListener("keydown",this.binds),this.raf&&cancelAnimationFrame(this.raf)}}function M(l){let t,s,e,i,o,r,h;return{c(){t=d("div"),s=d("div"),e=m("Score: "),i=d("span"),o=m("0"),r=L(),h=d("div"),this.h()},l(a){t=f(a,"DIV",{class:!0});var n=u(t);s=f(n,"DIV",{class:!0,style:!0});var v=u(s);e=w(v,"Score: "),i=f(v,"SPAN",{});var y=u(i);o=w(y,"0"),y.forEach(c),v.forEach(c),r=D(n),h=f(n,"DIV",{class:!0}),u(h).forEach(c),n.forEach(c),this.h()},h(){b(s,"class","stat svelte-5qcn8r"),C(s,"margin-bottom","20px"),b(h,"class","stage rx10 p5 svelte-5qcn8r"),b(t,"class","f-col al-ct j-ct")},m(a,n){I(a,t,n),p(t,s),p(s,e),p(s,i),p(i,o),l[2](i),p(t,r),p(t,h),l[3](h)},p:g,i:g,o:g,d(a){a&&c(t),l[2](null),l[3](null)}}}function O(l,t,s){let e,i,o;T(()=>(o=new A(e,i),()=>o.kill()));function r(a){_[a?"unshift":"push"](()=>{i=a,s(1,i)})}function h(a){_[a?"unshift":"push"](()=>{e=a,s(0,e)})}return[e,i,r,h]}class N extends E{constructor(t){super(),S(this,t,O,M,k,{})}}export{N as component};
