import{a as y,f as x}from"../chunks/BoSxuPc0.js";import"../chunks/Vj2otop3.js";import{o as v}from"../chunks/DUg0sjYP.js";import{aa as w,ac as E,s as c,c as d,g as a,ab as f,r as u,B as m}from"../chunks/C97ByKIQ.js";import{b}from"../chunks/Cyod68o_.js";import{i as S}from"../chunks/CGskxf4h.js";const l={colors:{ghost:"#ddd"},cellBase:{borderRadius:"8px",background:"transparent",boxShadow:"6px 6px 12px var(--elevated-D), -6px -6px 12px var(--elevated-L)"}};class k{constructor(t,s){this.cols=10,this.rows=20,this.board=[],this.nodes=[],this.bag=[],this.p={x:0,y:0,shape:[],type:""},this.score=0,this.over=!1,this.last=0,this.dt=0,this.step=1e3,this.raf=null,this.colors={I:"#00f0f0",O:"#f0f000",T:"#a000f0",S:"#00f000",Z:"#f00000",J:"#0000f0",L:"#f0a000"},this.root=t,this.scoreNode=s,this.binds=this.binds.bind(this),this.loop=this.loop.bind(this),this.init()}init(){this.board=Array.from({length:this.rows},()=>Array(this.cols).fill(0)),this.initGrid(),this.reset(),document.addEventListener("keydown",this.binds),this.loop()}initGrid(){this.root.innerHTML="",this.nodes=[],Object.assign(this.root.style,{display:"grid",gridTemplateColumns:`repeat(${this.cols}, 1fr)`,gap:"0.35vmin"});for(let t=0;t<this.rows*this.cols;t++){const s=document.createElement("div");this.root.appendChild(s),this.nodes.push(s)}}binds(t){if(this.over)return;const s=t.keyCode;s===37&&this.move(-1),s===39&&this.move(1),s===40&&this.drop(),s===38&&this.rotate(1),s===32&&this.hardDrop()}getPiece(t){return t==="I"?[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]:t==="L"?[[0,2,0],[0,2,0],[0,2,2]]:t==="J"?[[0,3,0],[0,3,0],[3,3,0]]:t==="O"?[[4,4],[4,4]]:t==="Z"?[[5,5,0],[0,5,5],[0,0,0]]:t==="S"?[[0,6,6],[6,6,0],[0,0,0]]:t==="T"?[[0,7,0],[7,7,7],[0,0,0]]:[]}shuffle(){const t="ILJOTSZ".split("");for(let s=t.length-1;s>0;s--){const i=Math.floor(Math.random()*(s+1));[t[s],t[i]]=[t[i],t[s]]}this.bag.push(...t)}reset(){this.bag.length===0&&this.shuffle(),this.p.type=this.bag.pop(),this.p.shape=this.getPiece(this.p.type),this.p.y=0,this.p.x=(this.cols/2|0)-(this.p.shape[0].length/2|0),this.collide(this.p.x,this.p.y,this.p.shape)&&(this.board.forEach(t=>t.fill(0)),this.score=0,this.updateScore())}collide(t,s,i){for(let e=0;e<i.length;e++)for(let o=0;o<i[e].length;o++)if(i[e][o]!==0&&(this.board[s+e]&&this.board[s+e][t+o])!==0)return!0;return!1}rotate(t){this.p.x;const s=this.p.shape.map(i=>[...i]);for(let i=0;i<s.length;++i)for(let e=0;e<i;++e)[s[e][i],s[i][e]]=[s[i][e],s[e][i]];t>0?s.forEach(i=>i.reverse()):s.reverse(),this.collide(this.p.x,this.p.y,s)||(this.p.shape=s)}move(t){this.p.x+=t,this.collide(this.p.x,this.p.y,this.p.shape)&&(this.p.x-=t)}drop(){this.p.y++,this.collide(this.p.x,this.p.y,this.p.shape)&&(this.p.y--,this.merge(),this.reset(),this.sweep()),this.dt=0}hardDrop(){for(;!this.collide(this.p.x,this.p.y+1,this.p.shape);)this.p.y++;this.drop()}merge(){this.p.shape.forEach((t,s)=>{t.forEach((i,e)=>{i!==0&&(this.board[s+this.p.y][e+this.p.x]=i)})})}sweep(){let t=0;t:for(let s=this.rows-1;s>0;--s){for(let e=0;e<this.cols;++e)if(this.board[s][e]===0)continue t;const i=this.board.splice(s,1)[0].fill(0);this.board.unshift(i),++s,t++}t>0&&(this.score+=[0,40,100,300,1200][t],this.updateScore())}updateScore(){this.scoreNode.innerText=this.score.toString(),this.step=Math.max(100,1e3-Math.floor(this.score/500)*50)}draw(){const t=new Array(this.rows*this.cols).fill(null);this.board.forEach((i,e)=>{i.forEach((o,h)=>{o!==0&&(t[e*this.cols+h]=this.getColor(o))})});let s=this.p.y;for(;!this.collide(this.p.x,s+1,this.p.shape);)s++;this.p.shape.forEach((i,e)=>{i.forEach((o,h)=>{if(o!==0){const r=(s+e)*this.cols+(this.p.x+h);t[r]||(t[r]=l.colors.ghost)}})}),this.p.shape.forEach((i,e)=>{i.forEach((o,h)=>{o!==0&&(t[(this.p.y+e)*this.cols+(this.p.x+h)]=this.colors[this.p.type])})});for(let i=0;i<this.nodes.length;i++){const e=t[i],o=this.nodes[i];e?(Object.assign(o.style,l.cellBase),o.style.boxShadow=l.cellBase.boxShadow||"",o.style.backgroundColor=e,o.style.opacity="1"):(o.style.background="transparent",o.style.backgroundColor="transparent",o.style.boxShadow="none",o.style.opacity="0",o.style.borderRadius=l.cellBase.borderRadius,o.style.transition="")}}getColor(t){const s=["I","L","J","O","Z","S","T"];return this.colors[s[t-1]]||"#999"}loop(t=0){const s=t-this.last;this.last=t,this.dt+=s,this.dt>this.step&&this.drop(),this.draw(),this.raf=requestAnimationFrame(this.loop)}kill(){document.removeEventListener("keydown",this.binds),this.raf&&cancelAnimationFrame(this.raf)}}var L=x('<div class="f-col al-ct j-ct"><div class="stat svelte-7m702m" style="margin-bottom: 20px;">Score: <span>0</span></div> <div class="stage rx10 p5 svelte-7m702m"></div></div>');function B(n,t){w(t,!1);let s=m(),i=m(),e;v(()=>(e=new k(a(s),a(i)),()=>e.kill())),S();var o=L(),h=d(o),r=c(d(h));b(r,p=>f(i,p),()=>a(i)),u(h);var g=c(h,2);b(g,p=>f(s,p),()=>a(s)),u(o),y(n,o),E()}export{B as component};
