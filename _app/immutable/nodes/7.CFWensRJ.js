import{a as m,f as g}from"../chunks/DwUiUqJg.js";import"../chunks/ClsrCmgc.js";import{o as ht}from"../chunks/D9mFjqRu.js";import{h as V,a7 as ct,ax as X,ay as ot,aa as Z,ac as y,a9 as vt,s as b,c as T,a8 as $,g as l,r as O,B as U,W as _,a1 as z,w as dt}from"../chunks/xt6jhfzP.js";import{e as P,s as ut}from"../chunks/BT7ErN7D.js";import{i as E}from"../chunks/BRPBQEXC.js";import{e as pt}from"../chunks/DZuEIN0f.js";import{t as mt,s as _t}from"../chunks/4RDXAVyf.js";import{i as gt}from"../chunks/CKiMzT74.js";import{M as yt}from"../chunks/DclWkDLa.js";function j(s,t,e,n){var r=s.__style;if(V||r!==t){var c=mt(t);(!V||c!==s.getAttribute("style"))&&(c==null?s.removeAttribute("style"):s.style.cssText=c),s.__style=t}return n}class xt{constructor(t,e,n,r=0){this.arcs=[],this.tint=0,this.x=t,this.y=e,this.key=n,this.id=n,this.val=r,this.cap=this.val>0?1:2}reset(){this.arcs=[],this.id=this.key,this.val===0&&(this.tint=0),this.cap=this.val>0?1:2}add(t,e=!0){if(this.arcs.includes(t)?e&&this.del(t):this.arcs.push(t),this.arcs.length>this.cap){let n=this.arcs.splice(0,1)[0];L(this,n)}}del(t){if(this.arcs.includes(t)){let e=this.arcs.indexOf(t);this.arcs.splice(e,1),this.arcs.length===0&&this.val===0&&(this.tint=0)}}dist(t){return Math.abs(t.x-this.x)+Math.abs(t.y-this.y)}tag(t,e,n){this.id=n,this.tint===0&&(this.tint=t.tint);for(let r of this.arcs)r!==t&&r!==e&&r.tag(t,this,n)}nuke(){for(;this.arcs.length>0;){let t=this.arcs[0];L(t,this),t.nuke()}}rand(t,e){let n=[[0,-1],[-1,0],[1,0],[0,1]];for(let r=0;r<1;r++){let c=n[Math.floor(Math.random()*n.length)],i=this.x+c[0],a=this.y+c[1];if(i>=0&&i<e&&a>=0&&a<e){let v=t[i+a*e];S(v,this,!1)}}}grow(t,e){let n=[[0,-1],[-1,0],[1,0],[0,1]];for(let r of n){let c=this.x+r[0],i=this.y+r[1];if(c>=0&&c<e&&i>=0&&i<e){let a=t[c+i*e];if(a&&a.arcs.length===0){S(a,this,!1);return}}}if(this.arcs.length===1){let r=this.arcs[0],c=this.x+(this.x-r.x),i=this.y+(this.y-r.y);if(c>=0&&c<e&&i>=0&&i<e){let a=t[c+i*e];(a.arcs.length<=1||r.arcs.length===1)&&S(a,this,!1)}}}test(){let t=!1;if(this.arcs.length===2){let e=this.arcs[0],n=this.arcs[1];if(e.arcs.length===2){let r=e.arcs[0];r===this&&(r=e.arcs[1]),n.dist(r)===1&&(L(e,this),t=!0)}if(n.arcs.length===2){let r=n.arcs[0];r===this&&(r=n.arcs[1]),e.dist(r)===1&&(L(n,this),t=!0)}}return t}trim(t,e){let n=!1,r=0,c=[[0,-1],[-1,0],[1,0],[0,1]];for(let i of c){let a=this.x+i[0],v=this.y+i[1],x=this.x+i[0]*2,A=this.y+i[1]*2,w=a>=0&&a<e&&v>=0&&v<e?t[a+v*e]:void 0,F=x>=0&&x<e&&A>=0&&A<e?t[x+A*e]:void 0;w&&(w.id===this.id?(r++,w.arcs.length===1&&this.arcs.length===1&&(r=3)):F&&F.id===this.id&&this.arcs.length===1&&(r=3))}if(r>=3){let i=this.arcs[0];L(i,this),n=!0}return n}}function S(s,t,e=!0){if(s.id===t.id){L(s,t);return}s.tint!==t.tint&&s.tint!==0&&t.tint!==0||(s.add(t,e),t.add(s,e),s.tag(t,s,t.id),t.tag(s,t,s.id))}function L(s,t){s.del(t),t.del(s),s.tag(s,s,s.key),t.tag(t,t,t.key)}function wt(s){let t=s.length,e;for(;t!=0;)e=Math.floor(Math.random()*t),t--,[s[t],s[e]]=[s[e],s[t]];return s}function kt(s){let t=[],e=[];for(let i=0;i<s;i++)for(let a=0;a<s;a++)t.push(new xt(a,i,a+i*s));t.forEach(i=>i.rand(t,s));let n=!0;for(;n;){n=!1;let i=[...t];wt(i),i.forEach(a=>a.grow(t,s)),i.forEach(a=>{n|=a.test()}),i.forEach(a=>{n|=a.trim(t,s)})}let r=t.filter(i=>i.arcs.length===1),c=1;for(;r.length>0;){let i=r.pop(),a=r.filter(v=>v.id===i.id)[0];if(i&&a){let v=c/11.3%1;i.val=c,a.val=c,i.tint=v,a.tint=v,i.pair=a,a.pair=i,c++,e.push([i,a]),r=r.filter(x=>x.id!==i.id)}}return t.map(i=>i.reset()),{grid:t,sets:e}}function R(s){return s===0?"transparent":`hsl(${Math.floor(s*360)}, 70%, 60%)`}var Mt=g('<div class="f j-ct al-ct p10 fw7" style="font-size: 4em;">You win!</div>'),bt=g('<div class="pipe n svelte-133nz0i"></div>'),$t=g('<div class="pipe s svelte-133nz0i"></div>'),Et=g('<div class="pipe w svelte-133nz0i"></div>'),jt=g('<div class="pipe e svelte-133nz0i"></div>'),Lt=g('<div class="pipe svelte-133nz0i"></div> <!> <!> <!> <!>',1),At=g('<div class="dot f al-ct j-ct fw7 svelte-133nz0i"> </div>'),Ft=g("<div><!> <!></div>"),Nt=g('<!> <div class="box h-100 w-100 f-col j-ct p0 svelte-133nz0i"><!> <div class="grid p0 mx-a svelte-133nz0i"></div></div>',1);function Yt(s,t){ct(t,!1);let e=U(12),n=U([]),r=[],c=!1,i=null,a=U(!1);function v(){$(a,!1);let h=kt(l(e));$(n,h.grid),r=h.sets}function x(h){l(a)||h.tint!==0&&(i=h,c=!0)}function A(h){if(!c||!i||l(a))return;Math.abs(h.x-i.x)+Math.abs(h.y-i.y)===1&&(S(h,i),i=h,$(n,l(n)),W())}function w(){c=!1,i=null}function F(h){h&&(h.nuke(),$(n,l(n)),W())}function W(){let h=!0;l(n).filter(d=>d.arcs.length===0).length>0&&(h=!1);for(let d of r)d[0].id!==d[1].id&&(h=!1);$(a,h)}function N(h,f,d){return h.arcs.some(p=>p.x===h.x+f&&p.y===h.y+d)}ht(()=>{let h=new URLSearchParams(window.location.search),f=Number(h.get("scale")??12);return f>=5&&f<=15&&$(e,f),v(),window.addEventListener("mouseup",w),()=>window.removeEventListener("mouseup",w)}),X(()=>{},()=>{$(e,12)}),X(()=>{},()=>{v()}),ot(),gt();var Y=Nt(),C=Z(Y);yt(C,{description:"Flow based on numberlink",name:"Flow Game"});var D=b(C,2),H=T(D);{var tt=h=>{var f=Mt();m(h,f)};E(H,h=>{l(a)&&h(tt)})}var q=b(H,2);pt(q,5,()=>l(n),h=>h.key,(h,f)=>{const d=dt(()=>(z(R),l(f),_(()=>R(l(f).tint))));var p=Ft();let I;var J=T(p);{var it=k=>{var M=Lt(),B=Z(M),G=b(B,2);{var rt=o=>{var u=bt();y(()=>j(u,`background: ${l(d)??""};`)),m(o,u)};E(G,o=>{l(f),_(()=>N(l(f),0,-1))&&o(rt)})}var K=b(G,2);{var at=o=>{var u=$t();y(()=>j(u,`background: ${l(d)??""};`)),m(o,u)};E(K,o=>{l(f),_(()=>N(l(f),0,1))&&o(at)})}var Q=b(K,2);{var lt=o=>{var u=Et();y(()=>j(u,`background: ${l(d)??""};`)),m(o,u)};E(Q,o=>{l(f),_(()=>N(l(f),-1,0))&&o(lt)})}var nt=b(Q,2);{var ft=o=>{var u=jt();y(()=>j(u,`background: ${l(d)??""};`)),m(o,u)};E(nt,o=>{l(f),_(()=>N(l(f),1,0))&&o(ft)})}y(()=>j(B,`background: ${l(d)??""};`)),m(k,M)};E(J,k=>{l(f),_(()=>l(f).tint)&&k(it)})}var et=b(J,2);{var st=k=>{var M=At(),B=T(M,!0);O(M),y(G=>{j(M,`color: ${G??""};`),ut(B,(l(f),_(()=>l(f).val)))},[()=>(z(R),l(f),_(()=>R(l(f).tint)))]),m(k,M)};E(et,k=>{l(f),_(()=>l(f).val>0)&&k(st)})}O(p),y(()=>I=_t(p,1,"tile f al-ct j-ct ptr p-rel rx50 svelte-133nz0i",null,I,{end:l(f).val>0,pressed:l(f).tint})),P("mousedown",p,()=>x(l(f))),P("mouseenter",p,()=>A(l(f))),P("dblclick",p,()=>F(l(f))),m(h,p)}),O(q),O(D),y(()=>j(q,`--dim:${l(e)??""};--wall: 600px;`)),P("mouseleave",q,w),m(s,Y),vt()}export{Yt as component};
