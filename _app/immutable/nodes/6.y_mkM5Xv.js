import{a as m,f}from"../chunks/BoSxuPc0.js";import"../chunks/Vj2otop3.js";import{o as p}from"../chunks/DUg0sjYP.js";import{aa as y,ad as w,ac as b,ae as C}from"../chunks/C97ByKIQ.js";import{i as T}from"../chunks/CGskxf4h.js";import{M as x}from"../chunks/BDdOXPir.js";class P{constructor(e,i,t){this.startTiles=2,this.size=e,this.inputManager=new i,this.actuator=new t,this.inputManager.on("move",this.move.bind(this)),this.inputManager.on("restart",this.restart.bind(this)),this.inputManager.on("undo",this.undo.bind(this)),this.inputManager.on("keepPlaying",this.keepPlaying.bind(this)),this.setup()}restart(){this.actuator.continueGame(),this.setup()}undo(){this.undoState&&(this.grid=new g(this.undoState.grid.size,this.undoState.grid.cells),this.over=this.undoState.over,this.won=this.undoState.won,this.keepPlaying=this.undoState.keepPlaying,this.actuate())}keepPlaying(){this.keepPlaying=!0,this.actuator.continueGame()}isGameTerminated(){return this.over||this.won&&!this.keepPlaying}setup(){this.grid=new g(this.size),this.over=!1,this.won=!1,this.keepPlaying=!1,this.addStartTiles(),this.actuate()}addStartTiles(){for(var e=0;e<this.startTiles;e++)this.addRandomTile()}addRandomTile(){if(this.grid.cellsAvailable()){var e=Math.random()<.9?2:4,i=new c(this.grid.randomAvailableCell(),e);this.grid.insertTile(i)}}actuate(){this.actuator.actuate(this.grid,{over:this.over,won:this.won,terminated:this.isGameTerminated()})}serialize(){return{grid:this.grid.serialize(),over:this.over,won:this.won,keepPlaying:this.keepPlaying}}prepareTiles(){this.grid.eachCell(function(e,i,t){t&&(t.mergedFrom=null,t.save())})}moveTile(e,i){this.grid.cells[e.x][e.y]=null,this.grid.cells[i.x][i.y]=e,e.update(i)}move(e){this.undoState=this.serialize();var i=this;if(!this.isGameTerminated()){var t,a,n=this.getVector(e),s=this.buildTraversals(n),r=!1;this.prepareTiles(),s.x.forEach(function(l){s.y.forEach(function(v){if(t={x:l,y:v},a=i.grid.cellContent(t),a){var o=i.findFarthestPosition(t,n),h=i.grid.cellContent(o.next);if(h&&h.value===a.value&&!h.mergedFrom){var u=new c(o.next,a.value*2);u.mergedFrom=[a,h],i.grid.insertTile(u),i.grid.removeTile(a),a.update(o.next),u.value===2048&&(i.won=!0)}else i.moveTile(a,o.farthest);i.positionsEqual(t,a)||(r=!0)}})}),r&&(this.addRandomTile(),this.movesAvailable()||(this.over=!0),this.actuate())}}getVector(e){var i={0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}};return i[e]}buildTraversals(e){for(var i={x:[],y:[]},t=0;t<this.size;t++)i.x.push(t),i.y.push(t);return e.x===1&&(i.x=i.x.reverse()),e.y===1&&(i.y=i.y.reverse()),i}findFarthestPosition(e,i){var t;do t=e,e={x:t.x+i.x,y:t.y+i.y};while(this.grid.withinBounds(e)&&this.grid.cellAvailable(e));return{farthest:t,next:e}}movesAvailable(){return this.grid.cellsAvailable()||this.tileMatchesAvailable()}tileMatchesAvailable(){for(var e=this,i,t=0;t<this.size;t++)for(var a=0;a<this.size;a++)if(i=this.grid.cellContent({x:t,y:a}),i)for(var n=0;n<4;n++){var s=e.getVector(n),r={x:t+s.x,y:a+s.y},l=e.grid.cellContent(r);if(l&&l.value===i.value)return!0}return!1}positionsEqual(e,i){return e.x===i.x&&e.y===i.y}}class g{constructor(e,i){this.size=e,this.cells=i?this.fromState(i):this.empty()}empty(){for(var e=[],i=0;i<this.size;i++)for(var t=e[i]=[],a=0;a<this.size;a++)t.push(null);return e}fromState(e){for(var i=[],t=0;t<this.size;t++)for(var a=i[t]=[],n=0;n<this.size;n++){var s=e[t][n];a.push(s?new c(s.position,s.value):null)}return i}randomAvailableCell(){var e=this.availableCells();if(e.length)return e[Math.floor(Math.random()*e.length)]}availableCells(){var e=[];return this.eachCell(function(i,t,a){a||e.push({x:i,y:t})}),e}eachCell(e){for(var i=0;i<this.size;i++)for(var t=0;t<this.size;t++)e(i,t,this.cells[i][t])}cellsAvailable(){return!!this.availableCells().length}cellAvailable(e){return!this.cellOccupied(e)}cellOccupied(e){return!!this.cellContent(e)}cellContent(e){return this.withinBounds(e)?this.cells[e.x][e.y]:null}insertTile(e){this.cells[e.x][e.y]=e}removeTile(e){this.cells[e.x][e.y]=null}withinBounds(e){return e.x>=0&&e.x<this.size&&e.y>=0&&e.y<this.size}serialize(){for(var e=[],i=0;i<this.size;i++)for(var t=e[i]=[],a=0;a<this.size;a++)t.push(this.cells[i][a]?this.cells[i][a].serialize():null);return{size:this.size,cells:e}}}class z{constructor(){this.tileContainer=document.querySelector(".tile"),this.messageContainer=document.querySelector(".game-message")}actuate(e,i){var t=this;window.requestAnimationFrame(function(){t.clearContainer(t.tileContainer),e.cells.forEach(function(a){a.forEach(function(n){n&&t.addTile(n)})}),i.terminated&&(i.over?t.message(!1):i.won&&t.message(!0))})}continueGame(){this.clearMessage()}clearContainer(e){for(;e.firstChild;)e.removeChild(e.firstChild)}addTile(e){var i=this,t=document.createElement("div"),a=document.createElement("div"),n=e.previousPosition||{x:e.x,y:e.y},s=this.positionClass(n),r=["tile","tile-"+e.value,s];e.value>2048&&r.push("tile-super"),this.applyClasses(t,r),a.classList.add("tile-inner"),a.textContent=e.value,e.previousPosition?window.requestAnimationFrame(function(){r[2]=i.positionClass({x:e.x,y:e.y}),i.applyClasses(t,r)}):e.mergedFrom?(r.push("tile-merged"),this.applyClasses(t,r),e.mergedFrom.forEach(function(l){i.addTile(l)})):(r.push("tile-new"),this.applyClasses(t,r)),t.appendChild(a),this.tileContainer.appendChild(t)}applyClasses(e,i){e.setAttribute("class",i.join(" "))}normalizePosition(e){return{x:e.x+1,y:e.y+1}}positionClass(e){return e=this.normalizePosition(e),"tile-position-"+e.x+"-"+e.y}message(e){var i=e?"game-won":"game-over",t=e?"You win!":"Game over!";this.messageContainer.classList.add(i),this.messageContainer.getElementsByTagName("p")[0].textContent=t}clearMessage(){this.messageContainer.classList.remove("game-won"),this.messageContainer.classList.remove("game-over")}}class E{constructor(){this.events={},this.eventTouchstart="touchstart",this.eventTouchmove="touchmove",this.eventTouchend="touchend",this.listen()}on(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}emit(e,i){var t=this.events[e];t&&t.forEach(function(a){a(i)})}listen(){var e=this,i={38:0,39:1,40:2,37:3,75:0,76:1,74:2,72:3,87:0,68:1,83:2,65:3};document.addEventListener("keydown",function(s){var r=s.altKey||s.ctrlKey||s.metaKey||s.shiftKey,l=i[s.which];!r&&l!==void 0&&(s.preventDefault(),e.emit("move",l)),!r&&s.which===82&&e.restart.call(e,s),!r&&s.which===85&&e.undo.call(e,s)}),this.bindButtonPress("#retry-button",this.restart),this.bindButtonPress("#restart-button",this.restart),this.bindButtonPress("#undo-button",this.undo),this.bindButtonPress("#keep-button",this.keepPlaying);var t,a,n=document.getElementsByClassName("game-container")[0];n.addEventListener(this.eventTouchstart,function(s){!window.navigator.msPointerEnabled&&s.touches.length>1||s.targetTouches.length>1||(window.navigator.msPointerEnabled?(t=s.pageX,a=s.pageY):(t=s.touches[0].clientX,a=s.touches[0].clientY),s.preventDefault())}),n.addEventListener(this.eventTouchmove,function(s){s.preventDefault()}),n.addEventListener(this.eventTouchend,function(s){if(!(!window.navigator.msPointerEnabled&&s.touches.length>0||s.targetTouches.length>0)){var r,l;window.navigator.msPointerEnabled?(r=s.pageX,l=s.pageY):(r=s.changedTouches[0].clientX,l=s.changedTouches[0].clientY);var v=r-t,o=Math.abs(v),h=l-a,u=Math.abs(h);Math.max(o,u)>10&&e.emit("move",o>u?v>0?1:3:h>0?2:0)}})}restart(e){e.preventDefault(),this.emit("restart")}undo(e){e.preventDefault(),this.emit("undo")}keepPlaying(e){e.preventDefault(),this.emit("keepPlaying")}bindButtonPress(e,i){var t=document.querySelector(e);t.addEventListener("click",i.bind(this)),t.addEventListener(this.eventTouchend,i.bind(this))}}class c{constructor(e,i){this.mergedFrom=null,this.previousPosition=null,this.x=e.x,this.y=e.y,this.value=i||2}save(){this.previousPosition={x:this.x,y:this.y}}update(e){this.x=e.x,this.y=e.y}serialize(){return{position:{x:this.x,y:this.y},value:this.value}}}var M=f('<!> <div class="container"><div class="heading"><h1 class="title">2<sup>17</sup></h1> <button id="undo-button"><svg viewBox="0 0 32 32" width="28" height="28" fill="transparent" stroke="#fff"><path d="M29 16 C29 22 24 29 16 29 8 29 3 22 3 16 3 10 8 3 16 3 21 3 25 6 27 9 M20 10 L27 9 28 2"></path></svg></button> <button id="restart-button"><svg viewBox="0 0 32 32" width="28" height="28" fill="none" stroke="#fff"><path d="M16 2 L2 16 16 30 16 16 30 30 30 2 16 16 Z"></path></svg></button></div> <div class="game game-container"><div class="game-message"><p></p> <div class="lower"><a id="keep-button">Keep going</a> <a id="retry-button">Try again</a></div></div> <div class="grid"><div class="grid-row"><div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div></div> <div class="grid-row"><div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div></div> <div class="grid-row"><div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div></div> <div class="grid-row"><div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div> <div class="grid-cell"></div></div></div> <div class="tile"></div></div></div>',1);function G(d,e){y(e,!1),p(()=>new P(4,E,z)),T();var i=M(),t=w(i);x(t,{description:"Flow based on numberlink",name:"Flow Game"}),C(2),m(d,i),b()}export{G as component};
